import{s as V}from"./index-CiYh4-x1.js";import{r as u,c as w,i as c,l as x,o as y,k as i,j as n,d as z,t as D,b as m}from"./index-CY3I9z2Q.js";const $={__name:"index",setup(H){const r=u(!1),f=u("chi_tra"),b=u(null),v=u(null),h=u(""),_=u(""),R=[{name:"eng",lang:"English"},{name:"chi_sim",lang:"Simplified Chinese"},{name:"chi_tra",lang:"Traditional Chinese"}];function U(l="",e=""){const a=Math.max(l.length,e.length);let t="",s="";for(let o=0;o<a;o++){const g=l[o]||"",d=e[o]||"";g!==d?(t+=`<mark>${g||" "}</mark>`,s+=`<mark>${d||" "}</mark>`):(t+=g,s+=d)}return[t,s]}const T=w(()=>U(h.value,_.value)),j=w(()=>T.value[0]),C=w(()=>T.value[1]),I=async l=>{const e=l.target.files[0];if(!e)return;r.value=!0,h.value="",_.value="",v.value=null;const a=e.type;if(a==="application/pdf")console.log("PDF file detected"),r.value=!1;else if(a.startsWith("image/")){b.value=URL.createObjectURL(e),h.value=await k(e);const t=await P(e);v.value=t;const s=await F(t,"processed.jpg");_.value=await k(s),r.value=!1}else alert("Unsupported file type."),r.value=!1},P=l=>new Promise(e=>{const a=new Image;a.onload=()=>{const t=document.createElement("canvas"),s=t.getContext("2d");t.width=a.width,t.height=a.height,s.filter="grayscale(100%) contrast(150%)",s.drawImage(a,0,0),t.toBlob(o=>{e(URL.createObjectURL(o))},"image/jpeg")},typeof l=="string"?a.src=l:a.src=URL.createObjectURL(l)}),k=async l=>{const e=await V.createWorker(f.value,1,{logger:t=>console.log(t)}),{data:{text:a}}=await e.recognize(l);return await e.terminate(),a},F=async(l,e)=>{const t=await(await fetch(l)).blob();return new File([t],e,{type:t.type})};return(l,e)=>{const a=c("v-file-input"),t=c("v-col"),s=c("v-select"),o=c("v-row"),g=c("v-progress-circular"),d=c("v-img"),L=c("v-sheet"),O=c("v-container");return y(),x(O,null,{default:i(()=>[n(o,{class:"my-4",align:"center",justify:"space-between"},{default:i(()=>[n(t,{cols:"12",sm:"5"},{default:i(()=>[n(a,{label:"上傳圖片或 PDF",accept:"image/*,application/pdf",onChange:I,disabled:r.value,"hide-details":"","prepend-icon":"mdi-camera"},null,8,["disabled"])]),_:1}),n(t,{cols:"12",sm:"5"},{default:i(()=>[n(s,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=p=>f.value=p),items:R,"item-title":"lang","item-value":"name",label:"選擇語言",disabled:r.value,"hide-details":"","prepend-icon":"mdi-translate"},{item:i(({item:p})=>[z(D(`${p.lang} (${p.name})`),1)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),r.value?(y(),x(o,{key:0,justify:"center",class:"my-4"},{default:i(()=>[n(t,{cols:"12",class:"text-center"},{default:i(()=>[n(g,{indeterminate:"",color:"primary",size:"48"}),e[1]||(e[1]=m("div",null,"Processing...",-1))]),_:1,__:[1]})]),_:1})):(y(),x(o,{key:1},{default:i(()=>[n(t,{cols:"12",md:"6",class:"text-center"},{default:i(()=>[e[2]||(e[2]=m("h3",null,"Original Image",-1)),n(d,{src:b.value,"max-width":"100%","max-height":"300",contain:""},null,8,["src"]),e[3]||(e[3]=m("h4",{class:"mt-4"},"Recognized Text (Original)",-1)),n(L,{elevation:"1",class:"pa-4",style:{"white-space":"pre-wrap","background-color":"#f5f5f5"},innerHTML:j.value},null,8,["innerHTML"])]),_:1,__:[2,3]}),n(t,{cols:"12",md:"6",class:"text-center"},{default:i(()=>[e[4]||(e[4]=m("h3",null,"Processed Image",-1)),n(d,{src:v.value,"max-width":"100%","max-height":"300",contain:""},null,8,["src"]),e[5]||(e[5]=m("h4",{class:"mt-4"},"Recognized Text (Processed)",-1)),n(L,{elevation:"1",class:"pa-4",style:{"white-space":"pre-wrap","background-color":"#f5f5f5"},innerHTML:C.value},null,8,["innerHTML"])]),_:1,__:[4,5]})]),_:1}))]),_:1})}}};export{$ as default};
